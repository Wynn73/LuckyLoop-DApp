<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="LuckyLoop Lottery - A decentralized lottery on Base Network">
  <title>LuckyLoop Lottery</title>
  <style>
    :root {
      --primary: #6a1b9a;
      --primary-light: #9c4dff;
      --text: #333;
      --text-light: #f5f5f5;
      --background: #fff;
      --error: #d32f2f;
      --success: #388e3c;
      --warning: #ffa000;
    }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background-color: #f8f9fa;
      color: var(--text);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-align: center;
      line-height: 1.6;
    }
    .container {
      max-width: 500px;
      width: 90%;
      padding: 2rem;
      background: var(--background);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    h1 {
      color: var(--primary);
      margin-bottom: 1.5rem;
      font-weight: 600;
    }
    .description {
      margin-bottom: 2rem;
      color: #555;
      font-size: 1.1rem;
    }
    .button-group {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    .button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      min-width: 160px;
      flex: 1;
    }
    .button:hover:not(:disabled) {
      background: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .button:disabled {
      background: #cccccc;
      cursor: not-allowed;
      opacity: 0.7;
    }
    .button:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    .button.loading::after {
      content: " ‚è≥";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1rem;
    }
    .status {
      margin-top: 2rem;
      padding: 1rem;
      background: #f5f5f5;
      border-radius: 8px;
      text-align: left;
      transition: background 0.2s ease;
    }
    .status-item {
      margin: 0.5rem 0;
      display: flex;
      align-items: center;
      transition: opacity 0.3s ease;
    }
    .status-item.updated {
      animation: highlight 1s ease;
    }
    @keyframes highlight {
      0% { background: rgba(56, 142, 60, 0.1); }
      100% { background: transparent; }
    }
    .indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 10px;
    }
    .connected {
      background: var(--success);
      box-shadow: 0 0 6px var(--success);
    }
    .disconnected {
      background: var(--error);
    }
    .hidden {
      display: none;
    }
    .message {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 6px;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .error {
      background: rgba(211, 47, 47, 0.1);
      color: var(--error);
      border-left: 3px solid var(--error);
    }
    .success {
      background: rgba(56, 142, 60, 0.1);
      color: var(--success);
      border-left: 3px solid var(--success);
    }
    .success a {
      color: var(--success);
      text-decoration: underline;
    }
    .tx-link {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    .tx-link:hover {
      text-decoration: underline;
    }
    @media (max-width: 480px) {
      .container {
        padding: 1.5rem;
      }
      .button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container" role="region" aria-label="LuckyLoop Lottery Interface">
    <h1>LuckyLoop Lottery</h1>
    <p class="description">Join the decentralized lottery on Base Network! Entry fee: 0.01 ETH</p>
    
    <div class="button-group">
      <button id="connectBtn" class="button" aria-label="Connect your wallet">Connect Wallet</button>
      <button id="disconnectBtn" class="button hidden" aria-label="Disconnect wallet">Disconnect</button>
      <button id="enterBtn" class="button hidden" aria-label="Enter the lottery">Enter Lottery (0.01 ETH)</button>
      <button id="detailsBtn" class="button hidden" aria-label="View lottery details">View Lottery Details</button>
    </div>
    
    <div class="status" aria-live="polite">
      <div class="status-item" aria-label="Connection status">
        <span id="networkIndicator" class="indicator disconnected"></span>
        <span>Status: </span><span id="status">Not connected</span>
      </div>
      <div class="status-item" aria-label="Network status">
        <span id="chainIndicator" class="indicator disconnected"></span>
        <span>Network: </span><span id="network">Unknown</span>
      </div>
      <div class="status-item" aria-label="Wallet balance">
        <span id="balanceIndicator" class="indicator disconnected"></span>
        <span>Balance: </span><span id="balance">--</span>
      </div>
      <div class="status-item" aria-label="Number of lottery players">
        <span id="playersIndicator" class="indicator disconnected"></span>
        <span>Players: </span><span id="playerCount">--</span>
      </div>
      <div class="status-item" aria-label="Lottery prize pool">
        <span id="prizeIndicator" class="indicator disconnected"></span>
        <span>Prize Pool: </span><span id="prizePool">--</span>
      </div>
    </div>
    
    <div id="errorMessage" class="message error hidden" role="alert"></div>
    <div id="successMessage" class="message success hidden" role="alert"></div>
  </div>

  <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // DOM Elements
      const elements = {
        connectBtn: document.getElementById("connectBtn"),
        disconnectBtn: document.getElementById("disconnectBtn"),
        enterBtn: document.getElementById("enterBtn"),
        detailsBtn: document.getElementById("detailsBtn"),
        statusText: document.getElementById("status"),
        networkText: document.getElementById("network"),
        balanceText: document.getElementById("balance"),
        playerCountText: document.getElementById("playerCount"),
        prizePoolText: document.getElementById("prizePool"),
        networkIndicator: document.getElementById("networkIndicator"),
        chainIndicator: document.getElementById("chainIndicator"),
        balanceIndicator: document.getElementById("balanceIndicator"),
        playersIndicator: document.getElementById("playersIndicator"),
        prizeIndicator: document.getElementById("prizeIndicator"),
        errorMessage: document.getElementById("errorMessage"),
        successMessage: document.getElementById("successMessage")
      };

      // Configuration
      const CONFIG = {
        network: {
          chainId: 8453,
          name: "Base Mainnet",
          hexId: "0x2105",
          blockExplorer: "https://basescan.org",
          rpcUrls: ["https://mainnet.base.org"],
          nativeCurrency: { name: "Ether", symbol: "ETH", decimals: 18 }
        },
        contract: {
          address: "0x7102a550B0EcbBCbD289630Cd560189B44674192",
          abi: [
            {
              "inputs": [],
              "name": "enterLottery",
              "outputs": [],
              "stateMutability": "payable",
              "type": "function"
            },
            {
              "inputs": [],
              "name": "getPlayers",
              "outputs": [{"internalType": "address[]", "name": "", "type": "address[]"}],
              "stateMutability": "view",
              "type": "function"
            },
            {
              "inputs": [],
              "name": "getBalance",
              "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
              "stateMutability": "view",
              "type": "function"
            }
          ],
          entryFee: "0.01"
        }
      };

      // App State
      let state = {
        provider: null,
        signer: null,
        contract: null,
        account: null,
        balance: null
      };

      // Initialize
      const init = async () => {
        if (window.ethereum && window.ethereum.selectedAddress) {
          await connectWallet();
        }
        setupEvents();
      };

      // Connect wallet
      const connectWallet = async () => {
        if (!window.ethereum) {
          showError("Please install MetaMask or another Web3 wallet");
          return;
        }
        try {
          setLoading(elements.connectBtn, true);
          state.provider = new ethers.providers.Web3Provider(window.ethereum, "any");
          await state.provider.send("eth_requestAccounts", []);
          await checkNetwork();
          state.signer = state.provider.getSigner();
          state.account = await state.signer.getAddress();
          state.contract = new ethers.Contract(CONFIG.contract.address, CONFIG.contract.abi, state.signer);
          await updateAllData();
          updateUIConnected();
        } catch (err) {
          showError(parseError(err));
        } finally {
          setLoading(elements.connectBtn, false);
        }
      };

      // Check and switch network
      const checkNetwork = async () => {
        const network = await state.provider.getNetwork();
        if (network.chainId !== CONFIG.network.chainId) {
          try {
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: CONFIG.network.hexId }]
            });
          } catch (switchError) {
            if (switchError.code === 4902) {
              try {
                await window.ethereum.request({
                  method: 'wallet_addEthereumChain',
                  params: [{
                    chainId: CONFIG.network.hexId,
                    chainName: CONFIG.network.name,
                    rpcUrls: CONFIG.network.rpcUrls,
                    nativeCurrency: CONFIG.network.nativeCurrency,
                    blockExplorerUrls: [CONFIG.network.blockExplorer]
                  }]
                });
              } catch (addError) {
                showError(`Failed to add ${CONFIG.network.name}`);
                throw addError;
              }
            } else {
              showError(`Please switch to ${CONFIG.network.name}`);
              throw switchError;
            }
          }
        }
      };

      // Update all data
      const updateAllData = async () => {
        if (!state.account) return;
        await Promise.all([updateBalance(), updateLotteryDetails()]);
        // Highlight updated status items
        document.querySelectorAll('.status-item').forEach(item => {
          item.classList.add('updated');
          setTimeout(() => item.classList.remove('updated'), 1000);
        });
      };

      // Update balance
      const updateBalance = async () => {
        if (!state.account) return;
        try {
          state.balance = await state.provider.getBalance(state.account);
          const formattedBalance = ethers.utils.formatEther(state.balance);
          elements.balanceText.textContent = `${parseFloat(formattedBalance).toFixed(4)} ETH`;
          elements.balanceIndicator.className = "indicator connected";
          elements.enterBtn.disabled = parseFloat(formattedBalance) < parseFloat(CONFIG.contract.entryFee);
        } catch (err) {
          console.error("Balance update error:", err);
          elements.balanceText.textContent = "--";
          elements.balanceIndicator.className = "indicator disconnected";
        }
      };

      // Update lottery details
      const updateLotteryDetails = async () => {
        if (!state.contract) return;
        try {
          const [players, balance] = await Promise.all([
            state.contract.getPlayers().catch(() => []),
            state.contract.getBalance().catch(() => 0)
          ]);
          elements.playerCountText.textContent = players.length || "--";
          elements.prizePoolText.textContent = balance ? `${ethers.utils.formatEther(balance)} ETH` : "--";
          elements.playersIndicator.className = players.length !== null ? "indicator connected" : "indicator disconnected";
          elements.prizeIndicator.className = balance ? "indicator connected" : "indicator disconnected";
        } Jordan Russell
System: * Today's date and time is 08:33 AM EDT on Thursday, June 26, 2025.
